---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# rollout

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/rollout)](https://CRAN.R-project.org/package=rollout)
[![R-CMD-check](https://github.com/iancero/rollout/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/iancero/rollout/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/iancero/rollout/branch/main/graph/badge.svg)](https://app.codecov.io/gh/iancero/rollout?branch=main)
<!-- badges: end -->

A **rollout trial** involves "rolling out" an intervention across different sites or groups in incremental phases. There are many kinds of rollout trials (e.g., stepped-wedge, head-to-head, single-arm). The **rollout package** simulates and evaluates statistical properties (e.g., power) of a rollout study designs.

## Installation

You can install the development version of rollout like so:

```{r, eval = FALSE}
devtools::install_github("iancero/rollout")
```

## A basic example

Evaluating the power of a rollout design minimally involves: 

1. Specifying the rollout schedule (i.e., rollout design), expected effects of the intervention in that schedule, and other sample characteristics (e.g., number of cohorts, sample size of each cohort). 
2. Simulating several datasets consistent with the rollout schedule and expected effects.
3. Fitting a statistical model to each dataset (e.g., a multi-level regression model to test the effects of the intervention).
4. Evaluating the statistical properties of those models. For example, the power of the design can be estimated by tracking the proportion of times the model successfully detects the "true" intervention effect specified in Step 1.

### Step 1: Specify the rollout schedule, expected effects, and sample characteristics

In this step, we specify the rollout schedule and expected effects of the intervention. For example, we might specify that the intervention will be rolled out in three phases, each lasting a different amount of time.^[Note, the rollout package measures time in discrete steps, like days, months, or years. However, it is agnostic to units, so phases all need to be specified on the same time scale (e.g., if `baseline = 3` signifies "3 months" in your design, rollout will then assume `intervention = 2` is also in months). Lastly, the package does not (yet) support continuous time.] 

- A three month **baseline phase**, in which no intervention is applied, but data from each participating cohort are collected.
- An two month intervention phase, in which each cohort receives the intervention
- A four month sustainment, in which the intervention is no longer applied, but data are still collected to evaluate whether the effects of the intervention persist beyond its initial application.

Specifying the rollout schedule in the rollout package is done by creating a named list of phase durations. The names of the list elements correspond to the names of the phases, and the values correspond to the duration of each phase in time steps. For example, the rollout schedule described above would be specified as follows:

```{r}
library(rollout)

phase_durations <- list(baseline = 3, intervention = 2, sustainment = 4)
```

Phase effects are specified in a similar way. For example, we might specify that the intervention has no effect during the baseline phase, a positive effect during the intervention phase, and a smaller positive effect during the sustainment phase. 

```{r}
phase_effects <- list(baseline = 0, intervention = 2, sustainment = 1)
```

Lastly, we specify the number of cohorts and the number of subjects in each cohort. For example, we might specify that there are 12 cohorts, each with 100 subjects.

```{r}
n_cohorts <- 12
subjects_per_cohort <- 100
```

All of these specifications are then combined into a named list that is passed to the `simulate_rollout_samples()` function.

```{r}
sim_params <- list(
  phase_durations = phase_durations,
  phase_effects = phase_effects,
  n_cohorts = n_cohorts,
  subjects_per_cohort = subjects_per_cohort
)
```


### Step 2: Simulate data consistent with the rollout schedule and expected effects

In this step, we simulate several datasets consistent with the rollout schedule and expected effects. The `simulate_rollout_samples()` function generates a dataset with the specified number of cohorts and subjects per cohort, and adds columns for the phase, time, and outcome variables. The outcome variable is generated by summing the effects of the phase, time, and random error terms.

```{r, eval=FALSE}
simulated_samples_df <- simulate_rollout_samples(
  n_samples = 100, 
  params = sim_params)
```
































