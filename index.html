<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tools for Designing, Simulating, and Analyzing Implementation Rollout Trials • rollout</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Tools for Designing, Simulating, and Analyzing Implementation Rollout Trials">
<meta name="description" content="Provides a unified framework for designing, simulating, and analyzing implementation rollout trials, including stepped wedge, sequential rollout, head-to-head, multi-condition, and rollout implementation optimization designs. The package enables users to flexibly specify rollout schedules, incorporate site-level and nested data structures, generate outcomes under rich hierarchical models, and evaluate analytic strategies through simulation-based power analysis. By separating data generation from model fitting, the tools support assessment of bias, Type I error, and robustness to model misspecification. The workflow integrates with standard mixed-effects modeling approaches and the tidyverse ecosystem, offering transparent and reproducible tools for implementation scientists and applied statisticians.">
<meta property="og:description" content="Provides a unified framework for designing, simulating, and analyzing implementation rollout trials, including stepped wedge, sequential rollout, head-to-head, multi-condition, and rollout implementation optimization designs. The package enables users to flexibly specify rollout schedules, incorporate site-level and nested data structures, generate outcomes under rich hierarchical models, and evaluate analytic strategies through simulation-based power analysis. By separating data generation from model fitting, the tools support assessment of bias, Type I error, and robustness to model misspecification. The workflow integrates with standard mixed-effects modeling approaches and the tidyverse ecosystem, offering transparent and reproducible tools for implementation scientists and applied statisticians.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">rollout</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/iancero/rollout/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="rollout">rollout<a class="anchor" aria-label="anchor" href="#rollout"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="introduction-simulating-a-rollout-trial">Introduction: Simulating a Rollout Trial<a class="anchor" aria-label="anchor" href="#introduction-simulating-a-rollout-trial"></a>
</h2>
<p>Rollout trials, including stepped wedge and sequential rollout designs, allow staggered implementation of interventions across sites while collecting outcome data over time. These designs are increasingly used in implementation science because they balance practical, ethical, and statistical considerations when rolling out interventions in real-world settings.</p>
<p>The <code>rollout</code> R package supports the design and analysis of rollout trials using simulation-based methods. This tutorial demonstrates how to simulate, analyze, and estimate power for a stepped wedge trial with multiple sites per cohort. The workflow aligns with the following structure:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Define the rollout schedule</strong> across sites and cohorts.</li>
<li>
<strong>Join unit-level information</strong> such as the number of participants per site.</li>
<li>
<strong>Specify simulation parameters</strong> for intervention effects and variance components.</li>
<li>
<strong>Simulate outcomes</strong> under the specified design.</li>
<li>
<strong>Fit models</strong> across multiple simulated replicates.</li>
<li>
<strong>Evaluate bias and power</strong> of the planned design.</li>
</ol>
<p>By following this pipeline, you can efficiently evaluate and optimize your rollout trial design before conducting your study.</p>
</div>
<div class="section level2">
<h2 id="installing-the-rollout-package">Installing the <code>rollout</code> Package<a class="anchor" aria-label="anchor" href="#installing-the-rollout-package"></a>
</h2>
<p>You can install the release version directly from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rollout"</span><span class="op">)</span></span></code></pre></div>
<p>Or, you can install the development version of <code>rollout</code> directly from GitHub using the <code>remotes</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install remotes package if needed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install rollout from GitHub</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"iancero/rollout"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-and-package-loading">Setup and Package Loading<a class="anchor" aria-label="anchor" href="#setup-and-package-loading"></a>
</h2>
<p>We begin by loading the required packages and setting a seed for reproducibility. Throughout this tutorial, we will use the <code>tidyverse</code> for data manipulation and plotting, and the <code>rollout</code> package for design, simulation, and evaluation of rollout trials.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'tidyverse' was built under R version 4.5.2</span></span>
<span><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.5.2</span></span>
<span><span class="co">#&gt; Warning: package 'purrr' was built under R version 4.5.2</span></span>
<span><span class="co">#&gt; Warning: package 'stringr' was built under R version 4.5.2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/iancero/rollout" class="external-link">rollout</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>  <span class="co"># for reproducibility</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="defining-the-rollout-schedule">Defining the Rollout Schedule<a class="anchor" aria-label="anchor" href="#defining-the-rollout-schedule"></a>
</h2>
<p>We will simulate a <strong>stepped wedge rollout trial</strong> with:</p>
<ul>
<li><strong>4 cohorts</strong></li>
<li>
<strong>8 sites total</strong> (2 per cohort)</li>
<li><strong>8 timepoints</strong></li>
<li>Each cohort transitions to the intervention (<code>"intv"</code>) at a different time while data are collected continuously.</li>
</ul>
<p>We use a <code>tribble()</code> for clarity, then convert to long format using <code><a href="reference/pivot_schedule_longer.html">pivot_schedule_longer()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a stepped wedge schedule with 8 sites, 4 cohorts, 8 timepoints</span></span>
<span><span class="va">rollout_schedule</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">cohort</span>, <span class="op">~</span><span class="va">site</span>, <span class="op">~</span><span class="va">t1</span>, <span class="op">~</span><span class="va">t2</span>, <span class="op">~</span><span class="va">t3</span>, <span class="op">~</span><span class="va">t4</span>, <span class="op">~</span><span class="va">t5</span>, <span class="op">~</span><span class="va">t6</span>, <span class="op">~</span><span class="va">t7</span>, <span class="op">~</span><span class="va">t8</span>,</span>
<span>       <span class="fl">1</span>,    <span class="st">"A"</span>,  <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"intv"</span>,  <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>,</span>
<span>       <span class="fl">1</span>,    <span class="st">"B"</span>,  <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"intv"</span>,  <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>,</span>
<span>       <span class="fl">2</span>,    <span class="st">"C"</span>,  <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>,  <span class="st">"ctrl"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>,</span>
<span>       <span class="fl">2</span>,    <span class="st">"D"</span>,  <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>,  <span class="st">"ctrl"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>,</span>
<span>       <span class="fl">3</span>,    <span class="st">"E"</span>,  <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>,  <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>,</span>
<span>       <span class="fl">3</span>,    <span class="st">"F"</span>,  <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>,  <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>, <span class="st">"intv"</span>,</span>
<span>       <span class="fl">4</span>,    <span class="st">"G"</span>,  <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>,  <span class="st">"intv"</span>, <span class="st">"intv"</span>,</span>
<span>       <span class="fl">4</span>,    <span class="st">"H"</span>,  <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>, <span class="st">"ctrl"</span>,  <span class="st">"intv"</span>, <span class="st">"intv"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Transform to long format for simulation</span></span>
<span><span class="va">long_schedule</span> <span class="op">&lt;-</span> <span class="va">rollout_schedule</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/pivot_schedule_longer.html">pivot_schedule_longer</a></span><span class="op">(</span>time_cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"t"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview structure</span></span>
<span><span class="va">long_schedule</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span><span class="co">#&gt;   cohort site  chron_time condition local_time</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;fct&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1      1 A              1 ctrl               0</span></span>
<span><span class="co">#&gt; 2      1 A              2 ctrl               1</span></span>
<span><span class="co">#&gt; 3      1 A              3 intv               0</span></span>
<span><span class="co">#&gt; 4      1 A              4 intv               1</span></span>
<span><span class="co">#&gt; 5      1 A              5 intv               2</span></span>
<span><span class="co">#&gt; 6      1 A              6 intv               3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-unit-level-information">Adding Unit-Level Information<a class="anchor" aria-label="anchor" href="#adding-unit-level-information"></a>
</h2>
<p>Next, we specify the <strong>unit-level information</strong> for each site, which is sometimes available in advance of a trial. For this example, each site will have a slightly different number of units, reflecting real-world differences in site sizes.</p>
<p>We will then join this information to our long-format rollout schedule using <code><a href="reference/join_info.html">join_info()</a></code>. This will expand the dataset to include a row for each unit at each timepoint.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create unit-level information with variable site sizes</span></span>
<span><span class="va">unit_info</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">site</span>, <span class="op">~</span><span class="va">n_units</span>,</span>
<span>   <span class="st">"A"</span>,   <span class="fl">18</span>,</span>
<span>   <span class="st">"B"</span>,   <span class="fl">22</span>,</span>
<span>   <span class="st">"C"</span>,   <span class="fl">20</span>,</span>
<span>   <span class="st">"D"</span>,   <span class="fl">19</span>,</span>
<span>   <span class="st">"E"</span>,   <span class="fl">21</span>,</span>
<span>   <span class="st">"F"</span>,   <span class="fl">20</span>,</span>
<span>   <span class="st">"G"</span>,   <span class="fl">23</span>,</span>
<span>   <span class="st">"H"</span>,   <span class="fl">17</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join unit-level info to the long-format schedule</span></span>
<span><span class="va">design_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/join_info.html">join_info</a></span><span class="op">(</span></span>
<span>  <span class="va">long_schedule</span>,</span>
<span>  unit_info <span class="op">=</span> <span class="va">unit_info</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>  uncount_vars <span class="op">=</span> <span class="st">"n_units"</span>,</span>
<span>  .ids <span class="op">=</span> <span class="st">"unit_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the expanded design</span></span>
<span><span class="va">design_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;   cohort site  chron_time condition local_time unit_id</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;fct&gt;          &lt;dbl&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1      1 A              1 ctrl               0       1</span></span>
<span><span class="co">#&gt; 2      1 A              1 ctrl               0       2</span></span>
<span><span class="co">#&gt; 3      1 A              1 ctrl               0       3</span></span>
<span><span class="co">#&gt; 4      1 A              1 ctrl               0       4</span></span>
<span><span class="co">#&gt; 5      1 A              1 ctrl               0       5</span></span>
<span><span class="co">#&gt; 6      1 A              1 ctrl               0       6</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-simulation-parameters">Adding Simulation Parameters<a class="anchor" aria-label="anchor" href="#adding-simulation-parameters"></a>
</h2>
<p>We will now add <strong>simulation parameters</strong> to our design. A key advantage of <code>rollout</code> is the ability to expand a parameter grid, enabling the evaluation of multiple scenarios within the same simulation pipeline.</p>
<p>In this example: - We will evaluate two intervention effect sizes (<code>b_intv = 0.2</code> for a small effect, <code>b_intv = 0.5</code> for a moderate effect). - We will specify a constant site-level standard deviation (<code>sigma_site = 0.5</code>) and unit-level residual standard deviation (<code>sigma_unit = 1</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_df</span> <span class="op">&lt;-</span> <span class="va">design_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/add_parameter.html">add_parameter</a></span><span class="op">(</span></span>
<span>    b_intv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    sigma_site <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    sigma_unit <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview to confirm parameter expansion</span></span>
<span><span class="va">design_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 9</span></span>
<span><span class="co">#&gt;   cohort site  chron_time condition local_time unit_id b_intv sigma_site</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;fct&gt;          &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1      1 A              1 ctrl               0       1    0.2        0.5</span></span>
<span><span class="co">#&gt; 2      1 A              1 ctrl               0       1    0.5        0.5</span></span>
<span><span class="co">#&gt; 3      1 A              1 ctrl               0       2    0.2        0.5</span></span>
<span><span class="co">#&gt; 4      1 A              1 ctrl               0       2    0.5        0.5</span></span>
<span><span class="co">#&gt; 5      1 A              1 ctrl               0       3    0.2        0.5</span></span>
<span><span class="co">#&gt; 6      1 A              1 ctrl               0       3    0.5        0.5</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: sigma_unit &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="initializing-replicates">Initializing Replicates<a class="anchor" aria-label="anchor" href="#initializing-replicates"></a>
</h2>
<p>After adding simulation parameters, we expand our design to include replicates. This enables us to simulate multiple trials under the same design to estimate power and evaluate bias efficiently.</p>
<p>Here, we use 10 replicates to keep the example lightweight. In practice, the number of replicates should be chosen based on the precision you want for your power estimate. A common guideline is: <code>n = p*(1-p)/(se^2)</code>, where <code>se</code> is the desired standard error of the power estimate and <code>p</code> is the target power (for example, p = 0.80).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_df</span> <span class="op">&lt;-</span> <span class="va">design_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/initialize_replicates.html">initialize_replicates</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview structure with replicate IDs</span></span>
<span><span class="va">design_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 10</span></span>
<span><span class="co">#&gt;   sample_id cohort site  chron_time condition local_time unit_id b_intv</span></span>
<span><span class="co">#&gt;       &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;fct&gt;          &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1         1      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 2         2      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 3         3      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 4         4      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 5         5      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 6         6      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: sigma_site &lt;dbl&gt;, sigma_unit &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-outcomes">Simulating Outcomes<a class="anchor" aria-label="anchor" href="#simulating-outcomes"></a>
</h2>
<p>We now simulate the outcome data according to our specified design. This prepares the dataset for model fitting, power estimation, and bias evaluation.</p>
<div class="section level3">
<h3 id="adding-a-fixed-time-trend">Adding a Fixed Time Trend<a class="anchor" aria-label="anchor" href="#adding-a-fixed-time-trend"></a>
</h3>
<p>First, we add a small negative time trend (<code>b_time = -0.05</code>) to represent gradual improvement over time, independent of intervention.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_df</span> <span class="op">&lt;-</span> <span class="va">design_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/add_parameter.html">add_parameter</a></span><span class="op">(</span>b_time <span class="op">=</span> <span class="op">-</span><span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-fixed-effects">Adding Fixed Effects<a class="anchor" aria-label="anchor" href="#adding-fixed-effects"></a>
</h3>
<p>Next, we add fixed effects for: - The intervention effect, applied when <code>condition == "intv"</code>. - The time trend, scaled by <code>chron_time</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_df</span> <span class="op">&lt;-</span> <span class="va">design_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/add_fixed_effect.html">add_fixed_effect</a></span><span class="op">(</span></span>
<span>    intv_effect <span class="op">=</span> <span class="va">b_intv</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">condition</span> <span class="op">==</span> <span class="st">"intv"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/add_fixed_effect.html">add_fixed_effect</a></span><span class="op">(</span></span>
<span>    time_trend <span class="op">=</span> <span class="va">b_time</span> <span class="op">*</span> <span class="va">chron_time</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-random-intercepts-for-sites">Adding Random Intercepts for Sites<a class="anchor" aria-label="anchor" href="#adding-random-intercepts-for-sites"></a>
</h3>
<p>We add a random intercept at the site level to simulate between-site variability.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_df</span> <span class="op">&lt;-</span> <span class="va">design_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/add_random_effect.html">add_random_effect</a></span><span class="op">(</span></span>
<span>    site_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma_site</span><span class="op">)</span>,</span>
<span>    .nesting <span class="op">=</span> <span class="st">"site"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-unit-level-residual-error">Adding Unit-Level Residual Error<a class="anchor" aria-label="anchor" href="#adding-unit-level-residual-error"></a>
</h3>
<p>We add unit-level residual error with variance <code>sigma_unit^2</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_df</span> <span class="op">&lt;-</span> <span class="va">design_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/add_error.html">add_error</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="va">sigma_unit</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generating-the-linear-outcome">Generating the Linear Outcome<a class="anchor" aria-label="anchor" href="#generating-the-linear-outcome"></a>
</h3>
<p>Finally, we generate a linear outcome (y_linear) by summing all fixed, random, and error components.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_df</span> <span class="op">&lt;-</span> <span class="va">design_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/add_linear_outcome.html">add_linear_outcome</a></span><span class="op">(</span>output_col <span class="op">=</span> <span class="st">"y_linear"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview simulated data</span></span>
<span><span class="va">design_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 16</span></span>
<span><span class="co">#&gt;   sample_id cohort site  chron_time condition local_time unit_id b_intv</span></span>
<span><span class="co">#&gt;       &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;fct&gt;          &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1         1      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 2         2      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 3         3      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 4         4      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 5         5      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; 6         6      1 A              1 ctrl               0       1    0.2</span></span>
<span><span class="co">#&gt; # ℹ 8 more variables: sigma_site &lt;dbl&gt;, sigma_unit &lt;dbl&gt;, b_time &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   .intv_effect &lt;dbl&gt;, .time_trend &lt;dbl&gt;, .site_intercept &lt;dbl&gt;, .error &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   y_linear &lt;dbl&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fitting-models-across-replicates">Fitting Models Across Replicates<a class="anchor" aria-label="anchor" href="#fitting-models-across-replicates"></a>
</h2>
<p>With our simulated outcomes generated, we now fit our planned analysis model across all replicates and parameter scenarios.</p>
<p>This process is automatically conducted in parallel, but you’ll need to load any packages for that parallel process explicitly (see line <code>packages = "lmerTest"</code>).</p>
<p>In this example: - We use linear mixed-effects models to account for site-level clustering. - Our model includes: - <code>condition</code> (intervention vs control), - <code>chron_time</code> (continuous time trend), - A random intercept for <code>site</code>. - We group by <code>sample_id</code> (replicates) and <code>b_intv</code> (effect size scenario).</p>
<p>This approach allows us to evaluate bias and power across both replicates and effect size conditions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitted_models</span> <span class="op">&lt;-</span> <span class="va">design_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">b_intv</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">nest</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/fit_models.html">fit_models</a></span><span class="op">(</span></span>
<span>    .x <span class="op">=</span> <span class="va">data</span>,</span>
<span>    .f <span class="op">=</span> <span class="op">~</span> <span class="fu">lmer</span><span class="op">(</span></span>
<span>      formula <span class="op">=</span> <span class="va">y_linear</span> <span class="op">~</span> <span class="va">condition</span> <span class="op">+</span> <span class="va">chron_time</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">site</span><span class="op">)</span>,</span>
<span>      data <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>,</span>
<span>    packages <span class="op">=</span> <span class="st">"lmerTest"</span><span class="op">)</span> <span class="co"># load lmerTest in each parallel process</span></span>
<span></span>
<span><span class="va">fitted_models</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span><span class="co">#&gt; Loading required namespace: lmerTest</span></span>
<span><span class="co">#&gt;   sample_id b_intv data                  model     </span></span>
<span><span class="co">#&gt;       &lt;int&gt;  &lt;dbl&gt; &lt;list&gt;                &lt;list&gt;    </span></span>
<span><span class="co">#&gt; 1         1    0.2 &lt;tibble [1,280 × 14]&gt; &lt;lmrMdLmT&gt;</span></span>
<span><span class="co">#&gt; 2         2    0.2 &lt;tibble [1,280 × 14]&gt; &lt;lmrMdLmT&gt;</span></span>
<span><span class="co">#&gt; 3         3    0.2 &lt;tibble [1,280 × 14]&gt; &lt;lmrMdLmT&gt;</span></span>
<span><span class="co">#&gt; 4         4    0.2 &lt;tibble [1,280 × 14]&gt; &lt;lmrMdLmT&gt;</span></span>
<span><span class="co">#&gt; 5         5    0.2 &lt;tibble [1,280 × 14]&gt; &lt;lmrMdLmT&gt;</span></span>
<span><span class="co">#&gt; 6         6    0.2 &lt;tibble [1,280 × 14]&gt; &lt;lmrMdLmT&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extracting-and-evaluating-results">Extracting and Evaluating Results<a class="anchor" aria-label="anchor" href="#extracting-and-evaluating-results"></a>
</h2>
<p>After fitting the models, we now extract key results and evaluate bias and power for our intervention effect.</p>
<p>We will: - <strong>Extract model estimates</strong> using <code><a href="reference/extract_model_results.html">extract_model_results()</a></code>. - <strong>Summarize power</strong> by calculating the proportion of p-values below .05 (done by default in <code>evaluate_model_results). - **Summarize bias** of the intervention effect using</code>eval_bias()<code>. - **Estimate a critical value** by calculating the observed value of b-estimates above the 97.5th percentile, using</code>eval_quantile()`.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract tidy model results</span></span>
<span><span class="va">model_results</span> <span class="op">&lt;-</span> <span class="va">fitted_models</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/extract_model_results.html">extract_model_results</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarize bias and power</span></span>
<span><span class="va">summary_results</span> <span class="op">&lt;-</span> <span class="va">model_results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">b_intv</span>, <span class="va">term</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/evaluate_model_results.html">evaluate_model_results</a></span><span class="op">(</span></span>
<span>    bias <span class="op">=</span> <span class="fu"><a href="reference/eval_bias.html">eval_bias</a></span><span class="op">(</span><span class="va">estimate</span>, term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(Intercept)"</span> <span class="op">=</span> <span class="fl">0</span>, conditionintv <span class="op">=</span> <span class="va">b_intv</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    critical_val <span class="op">=</span> <span class="fu"><a href="reference/eval_quantile.html">eval_quantile</a></span><span class="op">(</span><span class="va">estimate</span>, term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"conditionintv"</span> <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># View summary of bias and power</span></span>
<span><span class="va">summary_results</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 8</span></span>
<span><span class="co">#&gt; # Groups:   b_intv [2]</span></span>
<span><span class="co">#&gt;    b_intv term   n_models mean_estimate mean_std.error power   bias critical_val</span></span>
<span><span class="co">#&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt;         &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1    0.2 (Inte…       10       -0.155          0.207    0   -0.155       NA    </span></span>
<span><span class="co">#&gt;  2    0.2 chron…       10       -0.0444         0.0207   0.6 NA           NA    </span></span>
<span><span class="co">#&gt;  3    0.2 condi…       10        0.177          0.102    0.6 NA            0.328</span></span>
<span><span class="co">#&gt;  4    0.2 sd__(…       10       NA             NA       NA   NA           NA    </span></span>
<span><span class="co">#&gt;  5    0.2 sd__O…       10       NA             NA       NA   NA           NA    </span></span>
<span><span class="co">#&gt;  6    0.5 (Inte…       10       -0.192          0.208    0   -0.192       NA    </span></span>
<span><span class="co">#&gt;  7    0.5 chron…       10       -0.0404         0.0206   0.5 NA           NA    </span></span>
<span><span class="co">#&gt;  8    0.5 condi…       10        0.484          0.102    1   NA            0.590</span></span>
<span><span class="co">#&gt;  9    0.5 sd__(…       10       NA             NA       NA   NA           NA    </span></span>
<span><span class="co">#&gt; 10    0.5 sd__O…       10       NA             NA       NA   NA           NA</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/iancero/rollout/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/iancero/rollout/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
<li><a href="SUPPORT.html">Getting help</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rollout</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ian Cero <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-2862-0450" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>C. Hendricks Brown <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-0294-2419" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://CRAN.R-project.org/package=rollout" class="external-link"><img src="https://www.r-pkg.org/badges/version/rollout" alt="CRAN status"></a></li>
<li><a href="https://github.com/iancero/rollout/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/iancero/rollout/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/iancero/rollout" class="external-link"><img src="https://codecov.io/gh/iancero/rollout/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ian Cero, C. Hendricks Brown.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
